<!-- eslint-disable @angular-eslint/template/eqeqeq -->
<div class="database-detail">
  <div *ngIf="databaseStore.vm$ | async as vm"
       class="database-detail__tree">
    <ng-container *ngIf="vm.data">
      <div class="tree-title">Table ({{ vm.data.length || '0' }})</div>

      <div class="tree-item mt-2 mb-2"
           [class.--active]="mode == 'create'"
           (click)="selectedTableChange('create')">
        <span class="mix-icon">add</span>
        <span> Create new </span>
      </div>

      <ng-container *ngFor="let table of vm.data">
        <div class="tree-item"
             [class.--active]="id == table.id"
             (click)="selectedTableChange(table.id)">
          <span class="mix-icon">table</span>
          <span>{{ table.displayName }}</span>
        </div>
      </ng-container>
    </ng-container>
  </div>

  <div class="data-detail-page__content-container flex-grow-1">
    <tui-loader *ngIf="loadingState$ | async as state"
                class="data-detail-page"
                [formGroup]="form"
                [overlay]="true"
                [showLoader]="state === 'Loading'">
      <div class="data-detail-page__toolbar">
        <div class="data-detail-page__toolbar-top">
          <mix-input class="page-title"
                     [floatingLabel]="false"
                     formControlName="displayName"
                     placeHolder="Table display name"
                     size="s"></mix-input>

          <mix-button class="ml-auto"
                      [size]="'s'"
                      (click)="submit()">
            <span class="icon material-symbols-outlined"> save_as </span>
            {{ mode === 'create' ? 'Create' : 'Save' }}
          </mix-button>
        </div>

        <div class="data-detail-page__toolbar-separator"></div>

        <div class="deta-detail-page__toolbar-bottom">
          <nav [(activeItemIndex)]="activeTabIndex"
               tuiTabs>
            <button tuiTab>
              <span class="material-symbols-outlined"> feed </span>&nbsp;
              General
            </button>
            <button tuiTab>
              <span class="material-symbols-outlined"> settings </span>&nbsp;
              Field(s) Design
            </button>
          </nav>
        </div>
      </div>

      <div class="data-detail-page__content">
        <!-- Main Content -->
        <ng-container *ngIf="activeTabIndex === 0">
          <div class="data-detail-page__main-content">
            <p class="content-label mt-3">Table Display Name</p>
            <mix-input placeHolder="Your table friendly name"
                       formControlName="displayName"></mix-input>

            <mix-form-error class="mt-1"
                            formControlName="displayName"></mix-form-error>

            <p class="content-label mt-3">Table System Name</p>
            <mix-input placeHolder="Unique system name"
                       formControlName="systemName"></mix-input>

            <mix-form-error class="mt-1"
                            formControlName="systemName"></mix-form-error>

            <p class="content-label mt-3">Table Short Description</p>
            <mix-text-area placeHolder="Description"
                           formControlName="description"></mix-text-area>

            <tui-notification class="mt-3"
                              status="warning">
              Default system fields:
              <span class="text-highlight">id</span>,
              <span class="text-highlight">createdAt</span>,
              <span class="text-highlight">createdBy</span>,
              <span class="text-highlight">updatedAt</span>,
              <span class="text-highlight">priority</span>

              <br>
              <br>

              Visit
              <a href="https://docs.mixcore.org/"
                 target="_blank">Here</a> to
              get more information how Mixcore Database work.
            </tui-notification>
          </div>
        </ng-container>

        <!-- Content -->
        <ng-container *ngIf="activeTabIndex === 1">
          <div class="data-detail-page__main-content">
            <div class="data-detail-page__content-title">Entities</div>

            <ng-container *ngFor="let entity of data?.columns ?? []; let i = index">
              <mix-entity-form class="mt-3"
                               [entity]="entity"
                               (entityChange)="entityChange($event, i)"></mix-entity-form>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </tui-loader>
  </div>
</div>
